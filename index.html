<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
        "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Main</title>
    <link rel="icon" href="favicon.ico" />
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" src="main.js"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/dagre@0.7.4/dist/dagre.js"></script>
    <script src="https://cytoscape.org/cytoscape.js-dagre/cytoscape-dagre.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        .brand-logo {
            margin-left: 1vw;
        }

        .container {
            margin-top: 10vh;
        }

        .rsh4 {
            margin-top: 15vh;
        }

        .section-title {
            margin-bottom: 5vh;
        }

        .btn {
            width: 100%;
        }

        .progress {
            background-color: #e1f5fe;
        }

        .progress .indeterminate {
            background-color: #03a9f4;
        }

        .switch label input[type=checkbox]:checked+.lever:after {
            background-color: #03a9f4;
        }

        .switch label input[type=checkbox]:checked+.lever {
            background-color: #68cefd;
        }

        #cy {
            margin-left: 10%;
            margin-right: 10%;
            width: 80%;
            height: 60vh;
            left: 0;
            top: 0;
            z-index: 999;
            border: 2px solid lightgrey;
        }
    </style>
</head>
<body>
<nav class="nav-extended light-blue darken-3">
    <div class="nav-wrapper">
        <a href="#" class="brand-logo">Parties génératrices</a>
    </div>
    <div class="nav-content">
        <ul class="tabs tabs-transparent">
            <li class="tab"><a class="active" href="#abelian">Abélien</a></li>
            <li class="tab"><a href="#symetric">Symétrique</a></li>
            <li class="tab"><a href="#diedral">Diédral</a></li>
            <li class="tab"><a href="#star"> Inversibles </a></li>
            <li class="tab"><a href="#apropos">A propos</a></li>
        </ul>
    </div>
</nav>
<div id="abelian" class="col s12">
    <div class="container">
        <h4 class="center section-title">Groupe abélien</h4>
        <div class="row">
            <div class="col s6">
                <input type="number" name="resolve-input" id="abelian_input" placeholder="k?">
            </div>
            <div class="col s2">
                <a class="waves-effect waves-light btn light-blue darken-4" onclick="add_abelian()">
                    <i class="material-icons right">add</i>
                    Add
                </a>
            </div>
            <div class="col s2">
                <a class="waves-effect waves-light btn light-blue darken-4" onclick="clear_abelian_list()">
                    <i class="material-icons right">delete</i>
                    Clear
                </a>
            </div>
            <div class="col s2">
                <a id="abelian_compute_button" class="waves-effect waves-light btn light-blue darken-4" onclick="compute('abelian')">
                    <i class="material-icons right">arrow_forward</i>
                    Compute
                </a>
            </div>
        </div>
        <div id="abelian_loader" class="progress" style="display: none;">
            <div class="indeterminate"></div>
        </div>


        <h4 class="center rsh4"><span id="abelian_latex">\( \pi[\mathbb{Z} / 4 \mathbb{Z} \times \mathbb{Z} / k \mathbb{Z} ]  \)</span>
            = <span id="abelian_result"></span></h4>
        <h5>Graphes :
            <div class="switch">
                <label>
                    Off
                    <input type="checkbox" id="abelian_graphe_checkbox">
                    <span class="lever"></span>
                    On
                </label>
            </div>
        </h5>
    </div>
</div>
<div id="diedral" class="col s12">
    <div class="container">
        <h4 class="center section-title">Groupe Diédral</h4>
        <div class="row">
            <div class="col s10">
                <input type="number" name="resolve-input" id="diedral_input" placeholder="k ?" onkeyup="update_diedral_latex()">
            </div>
            <div class="col s2">
                <a id="diedral_compute_button" class="waves-effect waves-light btn light-blue darken-4" onclick="compute('diedral')">
                    <i class="material-icons right">arrow_forward</i>
                    Compute
                </a>
            </div>
        </div>
        <div id="diedral_loader" class="progress" style="display: none;">
            <div class="indeterminate"></div>
        </div>

        <h4 class="center rsh4"><span id="diedral_latex">\( \pi[ D_{2k}] \)</span> = <span
                id="diedral_result"></span></h4>
        <h5>Graphes :
            <div class="switch">
                <label>
                    Off
                    <input type="checkbox" id="diedral_graphe_checkbox">
                    <span class="lever"></span>
                    On
                </label>
            </div>
        </h5>
    </div>
</div>
<div id="symetric" class="col s12">
    <div class="container">
        <h4 class="center section-title">Groupe Symétrique</h4>
        <div class="row">
            <div class="col s10">
                <input type="number" name="resolve-input" id="symetric_input" placeholder="k ?" onkeyup="update_symetric_latex()">
            </div>
            <div class="col s2">
                <a id="symetric_compute_button" class="waves-effect waves-light btn light-blue darken-4" onclick="compute('symetric')">
                    <i class="material-icons right">arrow_forward</i>
                    Compute
                </a>
            </div>
        </div>
        <div id="symetric_loader" class="progress" style="display: none;">
            <div class="indeterminate"></div>
        </div>
        <h4 class="center rsh4"><span id="symetric_latex">\( \pi[ \mathfrak{S}_{k} ] \)</span> = <span
                id="symetric_result"></span></h4>
        <h5>Graphes :
            <div class="switch">
                <label>
                    Off
                    <input type="checkbox" id="symetric_graphe_checkbox">
                    <span class="lever"></span>
                    On
                </label>
            </div>
        </h5>
    </div>
</div>
<div id="apropos" class="col s12">
    <div class="container">
        <h4 class="center section-title">A propos</h4>
    </div>
</div>
<div id="star" class="col s12">
    <div class="container">
        <h4 class="center section-title">Inversibles modulo un entier</h4>
        <div class="row">
            <div class="col s10">
                <input type="number" name="resolve-input" id="star_input" placeholder="k ?" onkeyup="update_star_latex()">
            </div>
            <div class="col s2">
                <a id="star_compute_button" class="waves-effect waves-light btn light-blue darken-4" onclick="compute('star')">
                    <i class="material-icons right">arrow_forward</i>
                    Compute
                </a>
            </div>
        </div>
        <div id="star_loader" class="progress" style="display: none;">
            <div class="indeterminate"></div>
        </div>
        <h4 class="center rsh4"><span id="star_latex">\( \pi[ (\mathbb{Z}/n\mathbb{Z})^\star ] \)</span> = <span
                id="star_result"></span></h4>
        <h5>Graphes :
            <div class="switch">
                <label>
                    Off
                    <input type="checkbox" id="star_graphe_checkbox">
                    <span class="lever"></span>
                    On
                </label>
            </div>
        </h5>
    </div>
</div>


<div id="cy"></div>


</body>
<script type="text/javascript">
    var elems = document.querySelectorAll('.tabs');
    var instance = M.Tabs.init(elems, {onShow: function () {
            clear_graph();
        }});
    var list = [];
    var cy;
    document.getElementById("cy").style.display = "none";
    update_latex();
    function add_abelian() {
        let input = document.getElementById("abelian_input");
        list.push(parseInt(input.value))
        update_abelian_latex();
        input.value = "";
    }

    function clear_abelian_list() {
        list = [];
        update_abelian_latex();
    }

    function compute(type) {
        let resultat = document.getElementById(type+"_result");
        loader_change(type, true);
        let computed, input, contenu;
        let graphe = false;
        switch (type) {
            case "abelian":
                if (document.getElementById("abelian_graphe_checkbox").checked){
                    computed = ocamlcallback.abeliang(list);
                    graphe = true;
                } else {
                    computed = ocamlcallback.abelian(list);
                }
                break
            case "symetric":
                input = document.getElementById("symetric_input");
                contenu = parseInt(input.value);
                if (document.getElementById("symetric_graphe_checkbox").checked){
                    computed = ocamlcallback.symetricg(contenu);
                    graphe = true;
                } else {
                    computed = ocamlcallback.symetric(contenu);
                }
                break
            case "diedral":
                input = document.getElementById("diedral_input");
                contenu = parseInt(input.value);
                if (document.getElementById("diedral_graphe_checkbox").checked){
                    computed = ocamlcallback.diedralg(2*contenu);
                    graphe = true;
                } else {
                    computed = ocamlcallback.diedral(2*contenu);
                }
                break
            case "star":
                input = document.getElementById("star_input");
                contenu = parseInt(input.value);
                if (document.getElementById("star_graphe_checkbox").checked){
                    computed = ocamlcallback.starg(contenu);
                    graphe = true;
                } else {
                    computed = ocamlcallback.star(contenu);
                }
                break
        }
        loader_change(type, false);
        resultat.textContent = "\\("+computed[1][1].c+"["+computed[1][3].c+"]\\)";
        if (graphe){
            generate_graphe(computed[2].c);
        }
        MathJax.typeset();
    }


    function update_abelian_latex() {
        let result = document.getElementById("abelian_latex");
        let temporaire = "\\( \\pi [ ";
        for (let index = 0; list.length > index; index++) {
            if (index == list.length - 1) {
                temporaire = temporaire + " \\mathbb{Z}/ " + list[index] + " \\mathbb{Z} ";
            } else {
                temporaire = temporaire + " \\mathbb{Z}/ " + list[index] + " \\mathbb{Z} \\times ";
            }
        }
        temporaire = temporaire + "] \\)";
        result.textContent = temporaire;
        MathJax.typeset();
    }

    function update_symetric_latex() {
        let input = document.getElementById("symetric_input");
        let latex = document.getElementById("symetric_latex");
        latex.textContent = "\\( \\pi[ \\mathfrak{S}_{" + input.value + "} ]  \\)";
        MathJax.typeset();
    }

    function update_diedral_latex() {
        let input = document.getElementById("diedral_input");
        let latex = document.getElementById("diedral_latex");
        latex.textContent = "\\( \\pi[ D_{" + (2*parseInt(input.value)) + "} ]  \\)";
        MathJax.typeset();
    }

    function update_star_latex() {
        let input = document.getElementById("star_input");
        let latex = document.getElementById("star_latex");
        latex.textContent = "\\( \\pi[(\\mathbb{Z}/" + parseInt(input.value) +"\\mathbb{Z})^\\star" + "]  \\)";
        MathJax.typeset();
    }

    function update_latex() {
        update_abelian_latex();
        update_symetric_latex();
        update_diedral_latex();
        update_star_latex();
    }
    
    function loader_change(type, state) {
        let bouton = document.getElementById(type+"_compute_button");
        let loader = document.getElementById(type+"_loader");
        if (state){
            bouton.classList.add("disabled");
            loader.style.display = "block";
        }
        else {
            bouton.classList.remove("disabled");
            loader.style.display = "none";
        }
    }

    function generate_graphe(data) {
        clear_graph();
        document.getElementById("cy").style.display = "block";
        cy = window.cy = cytoscape({
            container: document.getElementById('cy'),
            boxSelectionEnabled: false,
            autounselectify: true,
            layout: {
                name: 'dagre'
            },
            style: [
                {
                    selector: 'node',
                    style: {
                        'label': 'data(id)',
                        'text-valign': 'center',
                        'color': '#000000',
                        'background-color': '#fff'
                    }
                },

                {
                    selector: 'edge',
                    style: {
                        'width': 1,
                        'target-arrow-shape': 'triangle',
                        'line-color': '#000000',
                        'target-arrow-color': '#000000',
                        'curve-style': 'bezier'
                    }
                }
            ],

            elements: data
        });
    }

    function clear_graph() {
        if (cy) {
            cy.destroy()
        }
        document.getElementById("cy").style.display = "none";
    }

    $('ul.tabs').on('click', 'a', function(e) {
        clear_graph();
    });

</script>
</html>
